(()=>{"use strict";var e;function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function o(e,o,n){return(o=function(e){var o=function(e,o){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(o)?o:String(o)}(o))in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}var n=(o(e={formFieldInputSelector:".form__field-input",formSubmitButtonSelector:".form__submit-button",formSubmitButtonInvalidClass:"form__submit-button_invalid",formValidationInvalidClass:"form_state_invalid"},"formSubmitButtonInvalidClass","form__submit-button_invalid"),o(e,"elementTemplateSelector",".element-template"),o(e,"elementsSelector",".elements"),o(e,"popupContainerImageSelector",".popup-container__image"),o(e,"popupSelector",".popup"),o(e,"popupContainerTextSelector",".popup-container__text"),o(e,"elementTitleSelector",".element__title"),o(e,"elementImageSelector",".element__image"),o(e,"elementGroupButtonActiveClass","element__group-button_active"),o(e,"popupOpenedClass","popup_opened"),o(e,"popupOpenedSelector",".popup_opened"),o(e,"elementSelector",".element"),o(e,"popupContainerCloseButtonSelector",".popup-container__close-button"),o(e,"elementGroupButtonSelector",".element__group-button"),o(e,"elementTrashButtonSelector",".element__trash-button"),o(e,"elementTrashButtonInvalidClass","element__trash-button_invalid"),o(e,"elementCounterSelector",".element__counter"),o(e,"profileAddButtonSelector",".profile__add-button"),o(e,"profileTitleSelector",".profile__title"),o(e,"profileSubtitleSelector",".profile__subtitle"),o(e,"profileEditButtonSelector",".profile__edit-button"),o(e,"profileImageSelector",".profile__image"),o(e,"popupContainerSelector",".popup-container"),o(e,"formSelector",".form"),o(e,"formProfileImageChangeSelector",".form-profile-image-change"),o(e,"formProfileEditSelector",".form-profile-edit"),o(e,"profileEditImageClass","profile__edit-image_hidden"),e),r={profilePopup:document.querySelector(".profile-popup"),addPopup:document.querySelector(".add-popup"),imagePopup:document.querySelector(".image-popup"),editImagePopup:document.querySelector(".edit-image-popup")};function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var i,a,u,s,f=function(){function e(e,t,o){t?(e.disabled=!1,e.classList.remove(o.formSubmitButtonInvalidClass)):(e.disabled="disabled",e.classList.add(o.formSubmitButtonInvalidClass))}function t(e,t,o){console.log("I hideError ".concat(e.name," ").concat(t.name));var n=e.querySelector("#".concat(t.name,"-error"));t.classList.remove(o.formValidationInvalidClass),n.textContent=""}return{enableValidation:function(o){c(document.forms).forEach((function(n){var r=n.querySelectorAll(o.formFieldInputSelector);e(n.querySelector(o.formSubmitButtonSelector),!1,o),c(r).forEach((function(r){r.addEventListener("input",(function(r){!function(o,n){var r=c(o.querySelectorAll(n.formFieldInputSelector)).map((function(e){return function(e,o,n){var r=o.validity.valid;return r?t(e,o,n):function(e,t,o){console.log("I showError ".concat(e.name," ").concat(t.name));var n=e.querySelector("#".concat(t.name,"-error"));t.classList.add(o.formValidationInvalidClass),n.textContent=t.validationMessage}(e,o,n),!r}(o,e,n)})),l=!0;c(r).some((function(e){return e}))&&(l=!1),e(o.querySelector(n.formSubmitButtonSelector),l,n)}(n,o)}))}))}))},resetFormValidation:function(o,n){o.reset();var r=o.querySelector(n.formSubmitButtonSelector);c(o.querySelectorAll("input")).forEach((function(e){t(o,e,n)})),e(r,!1,n)}}}(),m=function(){function e(e){!function(e){document.removeEventListener("keydown",t),e.querySelector(n.popupContainerCloseButtonSelector).removeEventListener("mousedown",o),e.removeEventListener("mousedown",r)}(e),e.classList.remove(n.popupOpenedClass)}function t(t){"Escape"===t.key&&e(document.querySelector(".popup_opened"))}function o(t){e(t.target.closest(n.popupSelector))}function r(t){var o=t.target.closest(n.popupOpenedSelector),r=o.querySelector(n.popupContainerSelector);t.composedPath().includes(r)||e(o)}return{openPopup:function(e){!function(e){document.addEventListener("keydown",t),e.querySelector(n.popupContainerCloseButtonSelector).addEventListener("mousedown",o),e.addEventListener("mousedown",r)}(e),e.classList.add(n.popupOpenedClass)},closePopup:e}}(),p={myProfile:{}},d=(i="https://nomoreparties.co",a="v1/".concat("wbf-cohort-5","/cards"),u="v1/".concat("wbf-cohort-5","/users"),s="68a0d7e3-249b-4c9f-8ef2-b362819ec551",{getProfile:function(e,t){fetch("".concat(i,"/").concat(u,"/me"),{headers:{authorization:s}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(t){p.myProfile=t,e(t)})).catch((function(e){t(e)})).finally((function(){console.log("finally")}))},getCards:function(e,t){fetch("".concat(i,"/").concat(a),{headers:{authorization:s}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(t){e(t)})).catch((function(e){t(e)})).finally((function(){console.log("finally")}))},patchProfile:function(e,t,o,n){fetch("".concat(i,"/").concat(u,"/me"),{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){o(e)})).catch((function(e){n(e)})).finally((function(){console.log("finally patch")}))},postCards:function(e,t,o,n){fetch("".concat(i,"/").concat(a),{method:"POST",body:JSON.stringify({name:e,link:t}),headers:{authorization:s,"Content-Type":"application/json"}}).then((function(e){return console.log(e),e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){o(e)})).catch((function(e){n(e)})).finally((function(){console.log("finally")}))},deleteCard:function(e,t,o){fetch("".concat(i,"/").concat(a,"/").concat(e),{method:"DELETE",headers:{authorization:s}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){t(e)})).catch((function(e){o(e)})).finally((function(){console.log("finally DELETE")}))},putLike:function(e,t,o){fetch("".concat(i,"/").concat(a,"/likes/").concat(e),{method:"PUT",headers:{authorization:s}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){t(e)})).catch((function(e){o(e)})).finally((function(){console.log("finally PUTlikes")}))},deleteLike:function(e,t,o){fetch("".concat(i,"/").concat(a,"/likes/").concat(e),{method:"DELETE",headers:{authorization:s}}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){t(e)})).catch((function(e){o(e)})).finally((function(){console.log("finally DELETElikes")}))},patchProfileAvatar:function(e,t,o){fetch("".concat(i,"/").concat(u,"/me/avatar"),{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){t(e)})).catch((function(e){o(e)})).finally((function(){console.log("finally patchAvatar")}))}});(function(){var e=document.querySelector(n.profileTitleSelector),t=document.querySelector(n.profileSubtitleSelector),o=document.querySelector(n.profileEditButtonSelector),c=document.querySelector(n.profileImageSelector);o.addEventListener("click",(function(o){var n=document.forms["form-profile-edit"];m.openPopup(r.profilePopup);var c=n.elements["form-profile-name"],l=n.elements["form-profile-occupation"];c.value=e.textContent,l.value=t.textContent;var i=new Event("input");c.dispatchEvent(i),l.dispatchEvent(i)}));var l=document.forms["form-profile-edit"];l.addEventListener("submit",(function(o){var c=l.elements["form-profile-name"],i=l.elements["form-profile-occupation"],a=l.querySelector(n.formSubmitButtonSelector);a.textContent="Сохранение...",d.patchProfile(c.value,i.value,(function(o){e.textContent=o.name,t.textContent=o.about,a.textContent="Сохранить"}),(function(e){a.textContent="Сохранить",console.log("Профиль не удалось обновить ".concat(e))})),m.closePopup(r.profilePopup),o.preventDefault()}));var i=document.querySelector(".profile__avatar"),a=document.querySelector(".profile__edit-image");function u(e){m.openPopup(r.editImagePopup)}i.addEventListener("mouseover",(function(e){a.addEventListener("click",u),a.classList.remove(n.profileEditImageClass)})),i.addEventListener("mouseout",(function(e){a.removeEventListener("click",u),a.classList.add(n.profileEditImageClass)})),d.getProfile((function(o){console.log(p.myProfile),e.textContent=o.name,t.textContent=o.about,c.src=o.avatar}),(function(e){console.log("Функция showProfile ".concat(e))}));var s=document.forms["form-profile-image-change"];s.addEventListener("submit",(function(e){var t=s.elements["form-edit-image-link"],o=s.querySelector(n.formSubmitButtonSelector);o.textContent="Сохранение...",d.patchProfileAvatar(t.value,(function(e){c.src=e.avatar,o.textContent="Сохранить"}),(function(e){o.textContent="Сохранить",console.log("Ошибка при обновлении аватара ".concat(e))})),m.closePopup(r.editImagePopup),e.preventDefault()}))})(),function(){var e=document.querySelector(n.elementTemplateSelector).content.querySelector(".element"),t=document.querySelector(n.elementsSelector),o=document.querySelector(n.popupContainerImageSelector),c=o.closest(n.popupSelector),l=c.querySelector(n.popupContainerTextSelector),i=document.forms["form-card-add"],a=i.elements["form-add-name"],u=i.elements["form-add-link"];function s(t){var o=e.cloneNode(!0);o.id=t._id,o.querySelector(n.elementTitleSelector).textContent=t.name;var r=o.querySelector(n.elementImageSelector);if(r.alt=t.name,r.src=t.link,o.querySelector(".element__image").addEventListener("click",y),t.owner._id===p.myProfile._id){var c=o.querySelector(".element__trash-button");c.addEventListener("click",v),c.classList.remove(n.elementTrashButtonInvalidClass)}var l=o.querySelector(".element__group-button");l.addEventListener("click",S);var i=o.querySelector(".element__counter"),a=t.likes.length;return i.textContent=a,t.likes.forEach((function(e){e._id===p.myProfile._id&&l.classList.add(n.elementGroupButtonActiveClass)})),o}function S(e){var t=e.target.closest(n.elementSelector),o=t.id;e.target.classList.contains(n.elementGroupButtonActiveClass)?d.deleteLike(o,(function(e){!function(e,t){e.querySelector(n.elementGroupButtonSelector).classList.remove(n.elementGroupButtonActiveClass);var o=t.likes.length;e.querySelector(n.elementCounterSelector).textContent=o}(t,e)}),(function(e){console.log("Функция removeLikeButton ".concat(e))})):d.putLike(o,(function(e){!function(e,t){e.querySelector(n.elementGroupButtonSelector).classList.add(n.elementGroupButtonActiveClass);var o=t.likes.length;e.querySelector(n.elementCounterSelector).textContent=o}(t,e)}),(function(e){console.log("Функция likeButton ".concat(e))}))}function v(e){var o=e.target.closest(n.elementSelector);d.deleteCard(o.id,(function(e){t.removeChild(o)}),(function(e){console.log("Ошибка при удалении карточки ".concat(e))}))}function y(e){var t=e.target,r=t.src,i=t.alt,a=t.closest(n.elementSelector).querySelector(n.elementTitleSelector).textContent;m.openPopup(c),l.textContent=a,o.src=r,o.alt=i}d.getCards((function(e){console.log(e[0]),document.querySelectorAll(n.elementSelector).forEach((function(e){return e.remove()})),e.map((function(e){return s(e)})).forEach((function(e){return t.appendChild(e)}))}),(function(e){console.log("Функция showCards ".concat(e))})),i.addEventListener("submit",(function(e){var o=i.querySelector(n.formSubmitButtonSelector);o.textContent="Создание...",d.postCards(a.value,u.value,(function(e){o.textContent="Создать";var n=s(e);t.prepend(n)}),(function(e){o.textContent="Создать",console.log("Ошибка добавления карточки ".concat(e))})),f.resetFormValidation(i,n),e.preventDefault()})),document.querySelector(n.profileAddButtonSelector).addEventListener("click",(function(e){f.resetFormValidation(i,n),m.openPopup(r.addPopup)}))}(),console.log("I am in index.js!"),f.enableValidation(n)})();